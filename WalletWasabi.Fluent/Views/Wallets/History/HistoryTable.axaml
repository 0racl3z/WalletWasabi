<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:history="clr-namespace:WalletWasabi.Fluent.ViewModels.Wallets.History"
             xmlns:c="clr-namespace:WalletWasabi.Fluent.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:DataType="history:HistoryViewModel"
             x:CompileBindings="True"
             x:Class="WalletWasabi.Fluent.Views.Wallets.History.HistoryTable">
  <DockPanel LastChildFill="True">

    <DockPanel DockPanel.Dock="Top" HorizontalAlignment="Stretch">

      <!-- Hide CJ switch -->
      <StackPanel Orientation="Horizontal" Spacing="10" DockPanel.Dock="Right">
        <TextBlock Text="Hide CoinJoin transactions" VerticalAlignment="Center" Opacity="0.6"/>
        <ToggleSwitch IsChecked="{Binding HideCoinJoin}" OnContent="{x:Null}" OffContent="{x:Null}" VerticalAlignment="Center"/>
      </StackPanel>

      <!-- Title -->
      <Label Content="Transaction History" DockPanel.Dock="Left" FontWeight="Bold" FontSize="16"/>
    </DockPanel>

    <DataGrid Items="{Binding Histories}" DockPanel.Dock="Bottom">
      <DataGrid.Styles>
        <Style Selector="PathIcon">
          <Setter Property="Width" Value="20"/>
          <Setter Property="Height" Value="20"/>
          <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style Selector="TextBlock">
          <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style Selector="StackPanel">
          <Setter Property="Orientation" Value="Horizontal" />
          <Setter Property="Spacing" Value="10" />
          <Setter Property="Margin" Value="10 0" />
        </Style>
      </DataGrid.Styles>

      <DataGrid.Columns>

        <!-- Date -->
        <DataGridTextColumn Header="Date"
                            x:DataType="history:HistoryItemViewModel"
                            Binding="{Binding Date}"
                            Width="*" />

        <!-- Labels -->
        <DataGridTemplateColumn Header="Labels"
                                Width="2*"
                                SortMemberPath="Labels">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <c:TagsBox x:DataType="history:HistoryItemViewModel" Items="{Binding Labels}" IsReadOnly="True" Margin="10 -2 10 -9" Padding="0" />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <!-- Outgoing -->
        <DataGridTemplateColumn Header="Outgoing"
                                Width="*"
                                SortMemberPath="OutgoingAmount">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel x:DataType="history:HistoryItemViewModel"
                          IsVisible="{Binding !!OutgoingAmount}">
                <LayoutTransformControl VerticalAlignment="Center">
                  <LayoutTransformControl.LayoutTransform>
                    <RotateTransform Angle="180" />
                  </LayoutTransformControl.LayoutTransform>
                  <PathIcon Data="{StaticResource chevron_down_circle_regular}" Opacity="0.6" />
                </LayoutTransformControl>
                <TextBlock Text="{Binding OutgoingAmount, StringFormat={}{0} BTC}" />
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <!-- Incoming -->
        <DataGridTemplateColumn Header="Incoming"
                                Width="*"
                                SortMemberPath="IncomingAmount">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel x:DataType="history:HistoryItemViewModel"
                          IsVisible="{Binding !!IncomingAmount}">
                <PathIcon Data="{StaticResource chevron_down_circle_regular}" Opacity="0.6" />
                <TextBlock Text="{Binding IncomingAmount, StringFormat={}{0} BTC}" />
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <!-- Status -->
        <DataGridTemplateColumn Header="Status"
                                Width="*"
                                SortMemberPath="IsConfirmed">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <Panel x:DataType="history:HistoryItemViewModel">
                <StackPanel IsVisible="{Binding IsConfirmed}">
                  <PathIcon Data="{StaticResource checkmark_filled}"
                            Foreground="{DynamicResource SystemControlBackgroundAccentBrush}" />
                  <TextBlock Text="Confirmed" />
                </StackPanel>

                <StackPanel IsVisible="{Binding !IsConfirmed}">
                  <PathIcon Data="{StaticResource channel_regular}" Opacity="0.6"/>
                  <TextBlock Text="Pending" />
                </StackPanel>
              </Panel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>
  </DockPanel>
</UserControl>
