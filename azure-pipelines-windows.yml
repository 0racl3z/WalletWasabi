trigger:
  batch: true

variables:
  testConfiguration: 'Debug'

jobs:
- job: Windows
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - task: UseDotNet@2
    displayName: 'Install .NET Core 3'
    inputs:
      version: 3.1.x
  - task: NuGetCommand@2
    inputs:
      command: 'restore'
      restoreSolution: '$(project)'
      feedsToUse: 'select'
      includeNuGetOrg: true
  - task: DotNetCoreCLI@2
    displayName: 'Build Debug'
    inputs:
      command: build
      arguments: --configuration Debug --no-restore
      noCache: true
  - task: DotNetCoreCLI@2
    displayName: 'Build Release'
    inputs:
      command: build
      arguments: --configuration Release --no-restore
      noCache: true
  - task: DotNetCoreCLI@2
    displayName: 'Test Debug'
    inputs:
      command: test
      projects: 'WalletWasabi.Tests/WalletWasabi.Tests.csproj'
      arguments: --configuration $(testConfiguration) --filter "FullyQualifiedName~UnitTests & FullyQualifiedName!~NodeBuildingTests.GetVersionTestsAsync" --logger "console;verbosity=detailed"
